<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="基于Arduino单片机的步进电机控制系统设计"><meta name="keywords" content="Arduino,step motor"><meta name="author" content="WALL-E"><meta name="copyright" content="WALL-E"><title>基于Arduino单片机的步进电机控制系统设计 | MH's Blog</title><link rel="shortcut icon" href="/img/EVE.ico"><link rel="stylesheet" href="/css/index.css?version=1.7.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.7.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://v1.hitokoto.cn/?encode=js&amp;charset=utf-8&amp;select=.footer_custom_text" defer></script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  }
} </script><meta name="generator" content="Hexo 5.4.2"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%A1%AC%E4%BB%B6%E7%B3%BB%E7%BB%9F%E7%9A%84%E7%BB%84%E6%88%90"><span class="toc-number">1.</span> <span class="toc-text"> 硬件系统的组成</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#arduino-uno%E5%8D%95%E7%89%87%E6%9C%BA"><span class="toc-number">1.1.</span> <span class="toc-text"> Arduino UNO单片机</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AD%A5%E8%BF%9B%E7%94%B5%E6%9C%BA28byj-48-5vdc"><span class="toc-number">1.2.</span> <span class="toc-text"> 步进电机（28BYJ-48 5VDC）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A9%B1%E5%8A%A8%E6%A8%A1%E5%9D%97uln2003"><span class="toc-number">1.3.</span> <span class="toc-text"> 驱动模块(ULN2003)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%8B%E9%92%AE%E7%94%B5%E4%BD%8D%E5%99%A8"><span class="toc-number">1.4.</span> <span class="toc-text"> 旋钮电位器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A1%AC%E4%BB%B6%E7%B3%BB%E7%BB%9F%E7%9A%84%E8%BF%9E%E6%8E%A5"><span class="toc-number">1.5.</span> <span class="toc-text"> 硬件系统的连接</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E7%A7%8D%E6%8E%A7%E5%88%B6%E6%96%B9%E5%BC%8F"><span class="toc-number">2.</span> <span class="toc-text"> 三种控制方式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E7%90%86%E5%9B%BE"><span class="toc-number">2.1.</span> <span class="toc-text"> 原理图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%95%E7%9B%B8%E5%9B%9B%E6%8B%8D%E6%8E%A7%E5%88%B6"><span class="toc-number">2.2.</span> <span class="toc-text"> 单相四拍控制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%8C%E7%9B%B8%E5%9B%9B%E6%8B%8D%E6%8E%A7%E5%88%B6"><span class="toc-number">2.3.</span> <span class="toc-text"> 双相四拍控制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AB%E6%8B%8D%E6%8E%A7%E5%88%B6"><span class="toc-number">2.4.</span> <span class="toc-text"> 八拍控制</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BB%BC%E5%90%88%E6%B5%8B%E8%AF%95"><span class="toc-number">3.</span> <span class="toc-text"> 综合测试</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E5%8D%95%E6%AD%A5%E7%9A%84%E4%BD%8D%E7%BD%AE%E6%8E%A7%E5%88%B6"><span class="toc-number">3.1.</span> <span class="toc-text"> 基于单步的位置控制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%B5%E4%BD%8D%E5%99%A8%E6%89%8B%E5%8A%A8%E8%BF%90%E8%A1%8C%E9%80%9F%E5%BA%A6-%E6%96%B9%E5%90%91%E6%8E%A7%E5%88%B6"><span class="toc-number">3.2.</span> <span class="toc-text"> 电位器手动运行速度、方向控制</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/WallET.png"></div><div class="author-info__name text-center">WALL-E</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">9</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">12</span></a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(/img/bg5.JPG)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">MH's Blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">主页</a><a class="site-page" href="/slides">幻灯</a><a class="site-page" href="/archives">归档</a><a class="site-page" href="/tags">标签</a><a class="site-page" href="/categories">分类</a></span><span class="pull-right"></span></div><div id="post-info"><div id="post-title">基于Arduino单片机的步进电机控制系统设计</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-06-08</time></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><p>用Arduino UNO单片机控制步进电机(28BYJ-48)，</p>
<ul>
<li>驱动器为ULN2003，</li>
<li>通过一个电位计控制运行速度和方向。</li>
</ul>
<span id="more"></span>
<h1 id="硬件系统的组成"><a class="markdownIt-Anchor" href="#硬件系统的组成"></a> 硬件系统的组成</h1>
<h2 id="arduino-uno单片机"><a class="markdownIt-Anchor" href="#arduino-uno单片机"></a> Arduino UNO单片机</h2>
<p align="center">
  <img src="/2020/06/08/project-step-motor/arduino_uno.png" width="60%">
  <br>
  <em>图：Arduino UNO——直插式(左)，贴片式(右)</em>
</p>
<p>本文选用的单片机即为 Arduino UNO R3 开发板，如前所述，其本质是基于 ATmega328P 微控制器的单片机开发板。它有 14 个数字输入/输出引脚(其中 6 个可用作 PWM 输出)，6个模拟输入脚，一个16MHz 晶体振荡器，一个 USB 接口，一个 DC 电源插座，一个 ICSP header 和一个复位按钮。 只需使用 USB 线将其连接到计算机，或者使用 AC-to-DC 适配器或电池为其供电即可开始使用。</p>
<p>Arduino UNO 板拥有非常丰富的资源，但在本文的开发过程中主要使用该开发板的 I2C 通信以及 TTL 串口通信的相关资源。</p>
<ul>
<li>SDA：A4</li>
<li>SCL：A5</li>
<li>Rx：pin0</li>
<li>Tx: pin1</li>
</ul>
<h2 id="步进电机28byj-48-5vdc"><a class="markdownIt-Anchor" href="#步进电机28byj-48-5vdc"></a> 步进电机（28BYJ-48 5VDC）</h2>
<p>本文选用一款非常流行并且价格便宜的步进电机作为控制对象，型号为 28BYJ-48 5VDC，其中各符号含义如下：</p>
<ul>
<li>28：有效外径</li>
<li>B：步进电机</li>
<li>Y：永磁型</li>
<li>J：减速机构</li>
<li>48：四相八拍</li>
<li>5V DC：工作电压为5V</li>
</ul>
<p>步进电机(28BYJ-48 5VDC)的实物如下图所示，该电机外部有一个 5 芯接口，颜色分别是蓝、粉、黄、橙、红</p>
<p align="center">
  <img src="/2020/06/08/project-step-motor/stepmotor1.jpg" width="85%">
  <br>
  <em>图：4相5线步进电机(28BYJ-48 5VDC)</em>
</p>
<p>步进电机(28BYJ-48 5VDC)的电机轴与输出轴之间通过一组齿轮进行啮合，通过计算可知传动比约为 <strong>1:64</strong>，即<strong>内部</strong>的电机轴转 <strong>64</strong> 圈，<strong>外部</strong>的输出轴转动 <strong>1</strong> 圈。</p>
<p align="center">
  <img src="/2020/06/08/project-step-motor/stepmotor-gear.png" width="85%">
  <br>
  <em>图：步进电机(28BYJ-48 5VDC)减速齿轮组</em>
</p>
<p>步进电机(28BYJ-48 5VDC) 内部有两个线圈，即 A 线圈和 B 线圈，其中 A 线圈的两头分别是 A+ (4) 和 A- (2) 端，B 线圈的两头分别是 B+ (3) 和 B- (1)。此外 A、B 线圈的中部抽头短接至 (5) 端，构成所谓单极 4 相 5 线的形式。各引出端的定义以及对应的线圈颜色如图。</p>
<p align="center">
  <img src="/2020/06/08/project-step-motor/stepmotor-Sch.png" width="85%">
  <br>
  <em>图：4相5线步进电机(28BYJ-48 5VDC)简化电路原理图</em>
</p>
<p>步进电机(28BYJ-48 5VDC)的核心部分如下图所示，包括上下 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span></span></span></span> 个完整的线圈，以及 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>4</mn></mrow><annotation encoding="application/x-tex">4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">4</span></span></span></span> 个带齿的圆盘，其中每个线圈绕在上下两个圆盘上。因为每个圆盘内部都有均匀分布的 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>8</mn></mrow><annotation encoding="application/x-tex">8</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">8</span></span></span></span> 个齿，所以 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>4</mn></mrow><annotation encoding="application/x-tex">4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">4</span></span></span></span> 个圆盘共 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>32</mn></mrow><annotation encoding="application/x-tex">32</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">3</span><span class="mord">2</span></span></span></span> 个齿，这些齿按照圆盘的不同依次错开一定的角度，相邻两个齿的角度为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>11.2</mn><msup><mn>5</mn><mo>∘</mo></msup></mrow><annotation encoding="application/x-tex">11.25^{\circ}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.674115em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">1</span><span class="mord">.</span><span class="mord">2</span><span class="mord"><span class="mord">5</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.674115em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">∘</span></span></span></span></span></span></span></span></span></span></span></span>，由 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>36</mn><msup><mn>0</mn><mo>∘</mo></msup><mi mathvariant="normal">/</mi><mn>32</mn></mrow><annotation encoding="application/x-tex">360^{\circ}/{32}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">3</span><span class="mord">6</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.674115em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">∘</span></span></span></span></span></span></span></span></span><span class="mord">/</span><span class="mord"><span class="mord">3</span><span class="mord">2</span></span></span></span></span> 计算得出。</p>
<p align="center">
  <img src="/2020/06/08/project-step-motor/stepmotor-Sch1.png" width="85%">
  <br>
  <em>图：4相5线步进电机(28BYJ-48 5VDC)的内部线圈和齿数</em>
</p>
<p>电机转子的内部是塑料轴心，外面是N极和S极相间的永磁体，一圈共有8组，其示意图如下图所示。当蓝、粉、黄、橙四根线与红色形成闭合回路时，对应相通电，对应圆盘上均匀分布的 8 个齿会同时产生对电机转子的电磁力。</p>
<p>综上，步进电机(28BYJ-48 5VDC) 的参数规格如表，其中 3 种控制方式的程序实现将在下一节给出。</p>
<p align="center">
  <img src="/2020/06/08/project-step-motor/stepmotor-Para.png" width="85%">
  <br>
</p>
<h2 id="驱动模块uln2003"><a class="markdownIt-Anchor" href="#驱动模块uln2003"></a> 驱动模块(ULN2003)</h2>
<p>Arduino 单片机的 I/O 端口的驱动电流较小，为了驱动步进电机工作，本文选择 <strong>ULN2003 芯片</strong>作为中间的驱动级。ULN2003 工作电压高，工作电流大，灌电流可达 500mA，并且能够在关态时承受 50V 的电压，输出还可以在高负载电流并行运行。相当于利用 ULN2003 的供电电源作为步进电机定子线圈电能。</p>
<p>ULN2003 是高耐压、大电流复合晶体管阵列，由七个硅 NPN 复合晶体管组成，每一对达林顿都串联一个 2.7K 的基极电阻，在 5V 的工作电压下它能与 TTL  和 CMOS 电路直接相连，可以直接处理原先需要标准逻辑缓冲器来处理的数据。</p>
<p align="center">
  <img src="/2020/06/08/project-step-motor/ULN.png" width="85%">
  <br>
  <em>图：步进电机驱动模块：ULN2003模块及内部电路</em>
</p>
<p>上面左图是 ULN2003 <strong>芯片</strong>内部连接图，该芯片有<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>16</mn></mrow><annotation encoding="application/x-tex">16</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">6</span></span></span></span>个引脚，各引脚端口的定义如下：</p>
<ul>
<li>**in1$\sim<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>7</mn><mo stretchy="false">(</mo><mi>p</mi><mi>i</mi><mi>n</mi><mn>1</mn></mrow><annotation encoding="application/x-tex">7(pin1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">7</span><span class="mopen">(</span><span class="mord mathdefault">p</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord">1</span></span></span></span>\sim$pin7)：**输入端，用于连接控制系统的 I/O 端。</li>
<li>**GRD(pin8)：**接地端。</li>
<li>**out1$\sim<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>7</mn><mo stretchy="false">(</mo><mi>p</mi><mi>i</mi><mi>n</mi><mn>16</mn></mrow><annotation encoding="application/x-tex">7(pin16</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">7</span><span class="mopen">(</span><span class="mord mathdefault">p</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord">1</span><span class="mord">6</span></span></span></span>\sim$pin10)：**输出端，与输入端对应。</li>
<li>**Vcc(pin9)：**公共端，本文应用中该端口接电源正极Vcc。</li>
</ul>
<p>下图是 ULN2003 <strong>模块</strong>的电路原理图。该模块处在 Arduino 单片机和步进电机之间。对比模块的实物图可知，该模块有三个地方可以与外界进行连接：</p>
<p align="center">
  <img src="/2020/06/08/project-step-motor/ULN-sch.png" width="85%">
  <br>
  <em>图：步进电机驱动模块：ULN2003模块电路原理图</em>
</p>
<ul>
<li>**左侧的 IN1、IN2、IN3、IN4：**连接 Aruduino 单片机的 I/O 端，单片机通过 I/O 端发送出步进电机的控制信号。</li>
<li>**右侧的 5 pin 的插座：**用于连接 5 线 4 相步进电机。</li>
<li>**底部的 5–12V 电源插口：**连接电源，给步进电机提供驱动电源。</li>
</ul>
<p>ULN2003 芯片的工作原理可以用下图来说明，图中步进电机四个绕组(coil1<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>∼</mo></mrow><annotation encoding="application/x-tex">\sim</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">∼</span></span></span></span>coil4)的一端连接 +5V，另一端分别连接 ULN2003 的out1<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>∼</mo></mrow><annotation encoding="application/x-tex">\sim</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">∼</span></span></span></span>out4。当输入端(in1<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>∼</mo></mrow><annotation encoding="application/x-tex">\sim</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">∼</span></span></span></span>in3)输入低电位时，此时对应的达林顿管截止，因此输出端(out1<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>∼</mo></mrow><annotation encoding="application/x-tex">\sim</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">∼</span></span></span></span>out3)未能与地相连(GRD pin8)，因此这三个绕组(coil1<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>∼</mo></mrow><annotation encoding="application/x-tex">\sim</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">∼</span></span></span></span>coil3)断电。当输入端(in4)输入高电位时，此时对应的达林顿管导通，因此输出端(out4)将与地导通(GRD pin8)，因此该绕组(coil4)得电。</p>
<p align="center">
  <img src="/2020/06/08/project-step-motor/ULN2003-3.png" width="85%">
  <br>
  <em>图：步进电机 ULN2003 模块工作原理</em>
</p>
<p>由此看出，输入端(in)与输出端(out)总是反相输出，因此ULN2003 芯片的内部结构可以用一个非门来表示，如下图。</p>
<p align="center">
  <img src="/2020/06/08/project-step-motor/ULN2003-4.png" width="65%">
  <br>
  <em>图：步进电机 ULN2003 模块工作原理</em>
</p>
<h2 id="旋钮电位器"><a class="markdownIt-Anchor" href="#旋钮电位器"></a> 旋钮电位器</h2>
<p>旋钮电位如图，其本质是一个滑动变阻器，1、3引脚两端接固定电压，这样通过旋转旋钮改变2、3(或1、2)两端所分得的电压，再通过Arduino Uno的模拟输入端读取该电压值，即可作为步进电机的控制输入。</p>
<p align="center">
  <img src="/2020/06/08/project-step-motor/Rotary.png" width="65%">
  <br>
  <em>图：旋钮电位器</em>
</p>
<h2 id="硬件系统的连接"><a class="markdownIt-Anchor" href="#硬件系统的连接"></a> 硬件系统的连接</h2>
<p>硬件系统中各模块的连接如图所示，其中，7.4V 锂电池给 Arduino Uno 供电，Arduino 的 5V 和 Gnd 分别连接旋转电位器和 ULN2003。Arduino Uno 的 A0 口连接旋转电位器的 OUT 端，读取电位器的值，输出端 8、9、10、11 分别连接 ULN2003 的 IN4、IN3、IN2 和 IN1。ULN2003的 5 芯插座连接步进电机。</p>
<p align="center">
  <img src="/2020/06/08/project-step-motor/connect-sch.png" width="65%">
  <br>
  <em>图：硬件模块的连接示意图</em>
</p>
<p>连接完成之后的步进电机控制系统如下图：</p>
<p align="center">
  <img src="/2020/06/08/project-step-motor/Hardware-real.JPG" width="65%">
  <br>
  <em>图：硬件模块连接完成之后的实物图</em>
</p>
<p>为了方便显示电机转动效果，在电机输出轴上固定了一根指针，并设计了一张带有刻度的圆盘。</p>
<h1 id="三种控制方式"><a class="markdownIt-Anchor" href="#三种控制方式"></a> 三种控制方式</h1>
<h2 id="原理图"><a class="markdownIt-Anchor" href="#原理图"></a> 原理图</h2>
<p>再看一下步进电机内部绕线的原理图：</p>
<p align="center">
  <img src="/2020/06/08/project-step-motor/stepmotor-Sch2.png" width="65%">
  <br>
  <em>图：4相5线步进电机(28BYJ-48 5VDC)简化电路原理图</em>
</p>
<h2 id="单相四拍控制"><a class="markdownIt-Anchor" href="#单相四拍控制"></a> 单相四拍控制</h2>
<p>单相四拍控制的原理是每拍只有 1 相导通，4 拍依次导通之后电机内轴转过 8 个齿中 1 个齿的角度，因此每拍电机内轴转动 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>36</mn><msup><mn>0</mn><mo>∘</mo></msup><mi mathvariant="normal">/</mi><mn>4</mn><mi mathvariant="normal">/</mi><mn>8</mn><mo>=</mo><mn>11.2</mn><msup><mn>5</mn><mo>∘</mo></msup></mrow><annotation encoding="application/x-tex">360^{\circ}/4/8=11.25^{\circ}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">3</span><span class="mord">6</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.674115em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">∘</span></span></span></span></span></span></span></span></span><span class="mord">/</span><span class="mord">4</span><span class="mord">/</span><span class="mord">8</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.674115em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">1</span><span class="mord">.</span><span class="mord">2</span><span class="mord"><span class="mord">5</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.674115em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">∘</span></span></span></span></span></span></span></span></span></span></span></span>，如表所示，其中 1 表示高电位，0 表示低电位。需要注意的是，每拍需要停留一定的时间，在程序中通过延时函数(delay)来实现。</p>
<p align="center">
  <img src="/2020/06/08/project-step-motor/tb-4pai.png" width="45%">
  <br>
</p>
<p>单相四拍控制下顺时针函数的程序如下：</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">clockwise_SinglePhase4Steps</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="comment">//1</span></span><br><span class="line">	<span class="built_in">digitalWrite</span>(motorPin4, HIGH);</span><br><span class="line">	<span class="built_in">digitalWrite</span>(motorPin3, LOW);</span><br><span class="line">	<span class="built_in">digitalWrite</span>(motorPin2, LOW);</span><br><span class="line">	<span class="built_in">digitalWrite</span>(motorPin1, LOW);</span><br><span class="line">	<span class="built_in">delay</span>(motorSpeed);</span><br><span class="line">	<span class="comment">//2</span></span><br><span class="line">	<span class="built_in">digitalWrite</span>(motorPin4, LOW);</span><br><span class="line">	<span class="built_in">digitalWrite</span>(motorPin3, HIGH);</span><br><span class="line">	<span class="built_in">digitalWrite</span>(motorPin2, LOW);</span><br><span class="line">	<span class="built_in">digitalWrite</span>(motorPin1, LOW);</span><br><span class="line">	<span class="built_in">delay</span>(motorSpeed);</span><br><span class="line">	<span class="comment">//3</span></span><br><span class="line">	<span class="built_in">digitalWrite</span>(motorPin4, LOW);</span><br><span class="line">	<span class="built_in">digitalWrite</span>(motorPin3, LOW);</span><br><span class="line">	<span class="built_in">digitalWrite</span>(motorPin2, HIGH);</span><br><span class="line">	<span class="built_in">digitalWrite</span>(motorPin1, LOW);</span><br><span class="line">	<span class="built_in">delay</span>(motorSpeed);</span><br><span class="line">	<span class="comment">//4</span></span><br><span class="line">	<span class="built_in">digitalWrite</span>(motorPin4, LOW);</span><br><span class="line">	<span class="built_in">digitalWrite</span>(motorPin3, LOW);</span><br><span class="line">	<span class="built_in">digitalWrite</span>(motorPin2, LOW);</span><br><span class="line">	<span class="built_in">digitalWrite</span>(motorPin1, HIGH);</span><br><span class="line">	<span class="built_in">delay</span>(motorSpeed);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="双相四拍控制"><a class="markdownIt-Anchor" href="#双相四拍控制"></a> 双相四拍控制</h2>
<p>双相4拍控制时步进电机的运作速度和单相4拍一致，不同的是每拍有相邻两相导通，因此产生的力矩要更大一下，引出线的导通时序如表所示。</p>
<p align="center">
  <img src="/2020/06/08/project-step-motor/tb-4pai2.png" width="45%">
  <br>
</p>
<p>双相四拍控制下顺时针函数的程序如下：</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">  <span class="function"><span class="type">void</span> <span class="title">clockwise_TwoPhase4Steps</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="comment">//1</span></span><br><span class="line">	<span class="built_in">digitalWrite</span>(motorPin4, HIGH);</span><br><span class="line">	<span class="built_in">digitalWrite</span>(motorPin3, HIGH);</span><br><span class="line">	<span class="built_in">digitalWrite</span>(motorPin2, LOW);</span><br><span class="line">	<span class="built_in">digitalWrite</span>(motorPin1, LOW);</span><br><span class="line">	<span class="built_in">delay</span>(motorSpeed);</span><br><span class="line">	<span class="comment">//2</span></span><br><span class="line">	<span class="built_in">digitalWrite</span>(motorPin4, LOW);</span><br><span class="line">	<span class="built_in">digitalWrite</span>(motorPin3, HIGH);</span><br><span class="line">	<span class="built_in">digitalWrite</span>(motorPin2, HIGH);</span><br><span class="line">	<span class="built_in">digitalWrite</span>(motorPin1, LOW);</span><br><span class="line">	<span class="built_in">delay</span>(motorSpeed);</span><br><span class="line">	<span class="comment">//3</span></span><br><span class="line">	<span class="built_in">digitalWrite</span>(motorPin4, LOW);</span><br><span class="line">	<span class="built_in">digitalWrite</span>(motorPin3, LOW);</span><br><span class="line">	<span class="built_in">digitalWrite</span>(motorPin2, HIGH);</span><br><span class="line">	<span class="built_in">digitalWrite</span>(motorPin1, HIGH);</span><br><span class="line">	<span class="built_in">delay</span>(motorSpeed);</span><br><span class="line">	<span class="comment">//4</span></span><br><span class="line">	<span class="built_in">digitalWrite</span>(motorPin4, HIGH);</span><br><span class="line">	<span class="built_in">digitalWrite</span>(motorPin3, LOW);</span><br><span class="line">	<span class="built_in">digitalWrite</span>(motorPin2, LOW);</span><br><span class="line">	<span class="built_in">digitalWrite</span>(motorPin1, HIGH);</span><br><span class="line">	<span class="built_in">delay</span>(motorSpeed);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="八拍控制"><a class="markdownIt-Anchor" href="#八拍控制"></a> 八拍控制</h2>
<p>使用八拍法控制步进电机时，电机内轴每拍转过的角度是前面两种方法的一半，因此控制的更为精细，引出线的导通时序如表所示。</p>
<p align="center">
  <img src="/2020/06/08/project-step-motor/tb-8pai.png" width="75%">
  <br>
</p>
<p>八拍控制下顺时针函数代码：</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">clockwise_8steps</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="comment">//1</span></span><br><span class="line">	<span class="built_in">digitalWrite</span>(motorPin4, HIGH);</span><br><span class="line">	<span class="built_in">digitalWrite</span>(motorPin3, LOW);</span><br><span class="line">	<span class="built_in">digitalWrite</span>(motorPin2, LOW);</span><br><span class="line">	<span class="built_in">digitalWrite</span>(motorPin1, LOW);</span><br><span class="line">	<span class="built_in">delay</span>(motorSpeed);</span><br><span class="line">	<span class="comment">//2</span></span><br><span class="line">	<span class="built_in">digitalWrite</span>(motorPin4, HIGH);</span><br><span class="line">	<span class="built_in">digitalWrite</span>(motorPin3, HIGH);</span><br><span class="line">	<span class="built_in">digitalWrite</span>(motorPin2, LOW);</span><br><span class="line">	<span class="built_in">digitalWrite</span>(motorPin1, LOW);</span><br><span class="line">	<span class="built_in">delay</span>(motorSpeed);</span><br><span class="line">	<span class="comment">//3</span></span><br><span class="line">	<span class="built_in">digitalWrite</span>(motorPin4, LOW);</span><br><span class="line">	<span class="built_in">digitalWrite</span>(motorPin3, HIGH);</span><br><span class="line">	<span class="built_in">digitalWrite</span>(motorPin2, LOW);</span><br><span class="line">	<span class="built_in">digitalWrite</span>(motorPin1, LOW);</span><br><span class="line">	<span class="built_in">delay</span>(motorSpeed);</span><br><span class="line">	<span class="comment">//4</span></span><br><span class="line">	<span class="built_in">digitalWrite</span>(motorPin4, LOW);</span><br><span class="line">	<span class="built_in">digitalWrite</span>(motorPin3, HIGH);</span><br><span class="line">	<span class="built_in">digitalWrite</span>(motorPin2, HIGH);</span><br><span class="line">	<span class="built_in">digitalWrite</span>(motorPin1, LOW);</span><br><span class="line">	<span class="built_in">delay</span>(motorSpeed);</span><br><span class="line">	<span class="comment">//5</span></span><br><span class="line">	<span class="built_in">digitalWrite</span>(motorPin4, LOW);</span><br><span class="line">	<span class="built_in">digitalWrite</span>(motorPin3, LOW);</span><br><span class="line">	<span class="built_in">digitalWrite</span>(motorPin2, HIGH);</span><br><span class="line">	<span class="built_in">digitalWrite</span>(motorPin1, LOW);</span><br><span class="line">	<span class="built_in">delay</span>(motorSpeed);</span><br><span class="line">	<span class="comment">//6</span></span><br><span class="line">	<span class="built_in">digitalWrite</span>(motorPin4, LOW);</span><br><span class="line">	<span class="built_in">digitalWrite</span>(motorPin3, LOW);</span><br><span class="line">	<span class="built_in">digitalWrite</span>(motorPin2, HIGH);</span><br><span class="line">	<span class="built_in">digitalWrite</span>(motorPin1, HIGH);</span><br><span class="line">	<span class="built_in">delay</span>(motorSpeed);</span><br><span class="line">	<span class="comment">//7</span></span><br><span class="line">	<span class="built_in">digitalWrite</span>(motorPin4, LOW);</span><br><span class="line">	<span class="built_in">digitalWrite</span>(motorPin3, LOW);</span><br><span class="line">	<span class="built_in">digitalWrite</span>(motorPin2, LOW);</span><br><span class="line">	<span class="built_in">digitalWrite</span>(motorPin1, HIGH);</span><br><span class="line">	<span class="built_in">delay</span>(motorSpeed);</span><br><span class="line">	<span class="comment">//8</span></span><br><span class="line">	<span class="built_in">digitalWrite</span>(motorPin4, HIGH);</span><br><span class="line">	<span class="built_in">digitalWrite</span>(motorPin3, LOW);</span><br><span class="line">	<span class="built_in">digitalWrite</span>(motorPin2, LOW);</span><br><span class="line">	<span class="built_in">digitalWrite</span>(motorPin1, HIGH);</span><br><span class="line">	<span class="built_in">delay</span>(motorSpeed);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="综合测试"><a class="markdownIt-Anchor" href="#综合测试"></a> 综合测试</h1>
<p>前面介绍了三种控制控制原理以及各自在 Arduino Uno 中完成4步和8步的代码实现，下面将以 8 拍控制方法为例，研究可以通过单步实现位置控制，以及通过电位器实现速度和方向的控制，</p>
<h2 id="基于单步的位置控制"><a class="markdownIt-Anchor" href="#基于单步的位置控制"></a> 基于单步的位置控制</h2>
<p>前面的代码中，每调用该函数一次，步进电机实际上已经运行了8步，为了能够控制步进电机的每一步，需要对前面的代码进行改进，其基本的控制流程如图所示。</p>
<p align="center">
  <img src="/2020/06/08/project-step-motor/diagram.png" width="100%">
  <br>
  <em>图：程序流程图</em>
</p>
<p>设计的目标是步进电机能够严格按照用户给定的步数进行动作，并且当给定的步数为正时，步进电机进行顺时针转动，相反，当给定的步数为负时，步进电机进行逆时针转动。实现这一功能的完整的程序如下所示，</p>
<p>基于8拍控制的完整程序</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> motorPin1 = <span class="number">11</span>;   <span class="comment">// Blue    - 28BY348 pin 1</span></span><br><span class="line"><span class="type">int</span> motorPin2 = <span class="number">10</span>;   <span class="comment">// Pink    - 288Y348 pin 2</span></span><br><span class="line"><span class="type">int</span> motorPin3 = <span class="number">9</span>;    <span class="comment">// Yellow  - 28BYJ48 pin 3</span></span><br><span class="line"><span class="type">int</span> motorPin4 = <span class="number">8</span>;    <span class="comment">// Orange  - 28BY348 pin 4</span></span><br><span class="line">					  <span class="comment">// Red     - 28BY348 pin 5 (vcc)</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> us_delay; <span class="comment">// </span></span><br><span class="line"><span class="type">int</span> step_number = <span class="number">0</span>; <span class="comment">// current step</span></span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> direction;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span> last_step_time = <span class="number">0</span>;<span class="comment">//save last time</span></span><br><span class="line"><span class="type">int</span> number_of_steps = <span class="number">4096</span>; <span class="comment">// total steps for one whole revolution</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">setup</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">pinMode</span>(motorPin1, OUTPUT);</span><br><span class="line">	<span class="built_in">pinMode</span>(motorPin2, OUTPUT);</span><br><span class="line">	<span class="built_in">pinMode</span>(motorPin3, OUTPUT);</span><br><span class="line">	<span class="built_in">pinMode</span>(motorPin4, OUTPUT);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">stepFun</span><span class="params">(<span class="type">int</span> steps_to_move)</span></span></span><br><span class="line"><span class="function"></span>&#123;   </span><br><span class="line">	<span class="type">int</span> steps_left = <span class="built_in">abs</span>(steps_to_move);  <span class="comment">// how many steps left to go</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span>(steps_to_move &gt; <span class="number">0</span>) &#123; direction = <span class="number">1</span>; &#125;</span><br><span class="line">	<span class="keyword">if</span>(steps_to_move &lt; <span class="number">0</span>) &#123; direction = <span class="number">0</span>; &#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">while</span>(steps_left &gt; <span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="type">unsigned</span> <span class="type">long</span> now = <span class="built_in">micros</span>();        </span><br><span class="line">		<span class="keyword">if</span>(now - last_step_time &gt;= us_delay)<span class="comment">// delay is satisfied</span></span><br><span class="line">		&#123;</span><br><span class="line">				last_step_time = now;</span><br><span class="line">				<span class="keyword">if</span>(direction)<span class="comment">//clockwise</span></span><br><span class="line">				&#123;</span><br><span class="line">					step_number++;</span><br><span class="line">					<span class="keyword">if</span>(step_number == number_of_steps)</span><br><span class="line">					&#123;</span><br><span class="line">						step_number = <span class="number">0</span>;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span>      <span class="comment">//anti-clockwise</span></span><br><span class="line">				&#123;</span><br><span class="line">					<span class="keyword">if</span>(step_number == <span class="number">0</span>)</span><br><span class="line">				&#123;</span><br><span class="line">					step_number = number_of_steps;</span><br><span class="line">				&#125;</span><br><span class="line">					step_number--;</span><br><span class="line">				&#125;</span><br><span class="line">				steps_left--;</span><br><span class="line">				<span class="built_in">clockwise_8steps</span>(step_number%<span class="number">8</span>);</span><br><span class="line">				<span class="comment">//Serial.println(&#x27;Hi&#x27;);</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">clockwise_8steps</span><span class="params">(<span class="type">int</span> this_step)</span></span>&#123;</span><br><span class="line">	<span class="keyword">switch</span>(this_step)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">			<span class="built_in">digitalWrite</span>(motorPin4, HIGH);</span><br><span class="line">			<span class="built_in">digitalWrite</span>(motorPin3, LOW);</span><br><span class="line">			<span class="built_in">digitalWrite</span>(motorPin2, LOW);</span><br><span class="line">			<span class="built_in">digitalWrite</span>(motorPin1, LOW);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">			<span class="built_in">digitalWrite</span>(motorPin4, HIGH);</span><br><span class="line">			<span class="built_in">digitalWrite</span>(motorPin3, HIGH);</span><br><span class="line">			<span class="built_in">digitalWrite</span>(motorPin2, LOW);</span><br><span class="line">			<span class="built_in">digitalWrite</span>(motorPin1, LOW);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">			<span class="built_in">digitalWrite</span>(motorPin4, LOW);</span><br><span class="line">			<span class="built_in">digitalWrite</span>(motorPin3, HIGH);</span><br><span class="line">			<span class="built_in">digitalWrite</span>(motorPin2, LOW);</span><br><span class="line">			<span class="built_in">digitalWrite</span>(motorPin1, LOW);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">			<span class="built_in">digitalWrite</span>(motorPin4, LOW);</span><br><span class="line">			<span class="built_in">digitalWrite</span>(motorPin3, HIGH);</span><br><span class="line">			<span class="built_in">digitalWrite</span>(motorPin2, HIGH);</span><br><span class="line">			<span class="built_in">digitalWrite</span>(motorPin1, LOW);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">			<span class="built_in">digitalWrite</span>(motorPin4, LOW);</span><br><span class="line">			<span class="built_in">digitalWrite</span>(motorPin3, LOW);</span><br><span class="line">			<span class="built_in">digitalWrite</span>(motorPin2, HIGH);</span><br><span class="line">			<span class="built_in">digitalWrite</span>(motorPin1, LOW);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">			<span class="built_in">digitalWrite</span>(motorPin4, LOW);</span><br><span class="line">			<span class="built_in">digitalWrite</span>(motorPin3, LOW);</span><br><span class="line">			<span class="built_in">digitalWrite</span>(motorPin2, HIGH);</span><br><span class="line">			<span class="built_in">digitalWrite</span>(motorPin1, HIGH);      </span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">			<span class="built_in">digitalWrite</span>(motorPin4, LOW);</span><br><span class="line">			<span class="built_in">digitalWrite</span>(motorPin3, LOW);</span><br><span class="line">			<span class="built_in">digitalWrite</span>(motorPin2, LOW);</span><br><span class="line">			<span class="built_in">digitalWrite</span>(motorPin1, HIGH);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">7</span>:</span><br><span class="line">			<span class="built_in">digitalWrite</span>(motorPin4, HIGH);</span><br><span class="line">			<span class="built_in">digitalWrite</span>(motorPin3, LOW);</span><br><span class="line">			<span class="built_in">digitalWrite</span>(motorPin2, LOW);</span><br><span class="line">			<span class="built_in">digitalWrite</span>(motorPin1, HIGH);   </span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">loop</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	us_delay = <span class="number">1000</span>;  <span class="comment">//set rotation time interval</span></span><br><span class="line">	<span class="built_in">stepFun</span>(<span class="number">1</span>);       <span class="comment">//command stepper motor walk for One Single Step.</span></span><br><span class="line">	<span class="built_in">delay</span>(<span class="number">100</span>);      <span class="comment">//halt for 0.1 second</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在上面的程序中，用户可以通过stepFun()函数，精确控制步进电机每 1 步动作，根据步距角的设定，当需要顺时针运行完整的一圈时只需要给该函数输入参数 4096 即可。</p>
<h2 id="电位器手动运行速度-方向控制"><a class="markdownIt-Anchor" href="#电位器手动运行速度-方向控制"></a> 电位器手动运行速度、方向控制</h2>
<p>前面实现了步进电机每 1 步的动作，通过读取旋转电位器的电压值可以改变每 1 步中线圈的通电时间，进一步实现运动速度和方向的手动调整，程序流程如下。</p>
<p align="center">
  <img src="/2020/06/08/project-step-motor/diagram2.png" width="40%">
  <br>
  <em>图：程序流程图</em>
</p>
<p>核心部分代码实现如下，首先通过 A0 口读取旋转电位器的电压值，并将其映射在-512到511之间，进一步计算出对应的延时变量，其次，通过 sign() 函数获取其符号，以决定电机轴转动的方向。最后，调用上一步中定义的基于单步的位置控制函数 stepFun() 控制电机运转。</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">type <span class="title">sign</span><span class="params">(type value)</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">type</span>((value&gt;<span class="number">0</span>)-(value&lt;<span class="number">0</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">loop</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> potValue = <span class="built_in">map</span>(<span class="built_in">analogRead</span>(A0),<span class="number">0</span>,<span class="number">1023</span>,<span class="number">-512</span>,<span class="number">511</span>);</span><br><span class="line">	us_delay = (<span class="number">512</span>-<span class="built_in">abs</span>(potValue))*<span class="number">20</span>+<span class="number">1000</span>;</span><br><span class="line">	<span class="built_in">stepFun</span>(<span class="number">1</span>*<span class="built_in">sign</span>(potValue));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>经测试，当电位器顺时针旋转到极限位置时，电机顺时针旋转并且此时的转速达到最大值，从此位置开始逆时针旋转电位器时，电机顺时针旋转速度逐渐下降，当电位器经过中间位置继续逆时针旋转时，电机开始逆时针旋转，并且转速随着电位器的旋转而逐渐增大。</p>
<blockquote>
<p>参考资料：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://youtu.be/B86nqDRskVU">28BYJ-48 Stepper Motor and ULN2003 Driver Intro</a></li>
<li><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=SUziz1zupGk">Chapter 10 - Exploring Stepper Motors (28-BYJ-48) with an Arduino</a></li>
</ul>
</blockquote>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">WALL-E</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://minhuanguo.github.io/2020/06/08/project-step-motor/">https://minhuanguo.github.io/2020/06/08/project-step-motor/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://minhuanguo.github.io">MH's Blog</a>！</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Arduino/">Arduino</a><a class="post-meta__tags" href="/tags/step-motor/">step motor</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2020/06/13/STM32-Encoder-PWM-Timer-GPIO/"><i class="fa fa-chevron-left">  </i><span>STM32_Encoder_PWM_Timer_GPIO</span></a></div><div class="next-post pull-right"><a href="/2020/06/06/hello-latex/"><span>KaTeX Test with hexo-theme-melody</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer class="footer-bg" style="background-image: url(/img/bg5.JPG)"><div class="layout" id="footer"><div class="copyright">&copy;2020 - 2022 By WALL-E</div><div class="framework-info"><span>驱动 - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="footer_custom_text">hitokoto</div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.7.0"></script><script src="/js/fancybox.js?version=1.7.0"></script><script src="/js/sidebar.js?version=1.7.0"></script><script src="/js/copy.js?version=1.7.0"></script><script src="/js/fireworks.js?version=1.7.0"></script><script src="/js/transition.js?version=1.7.0"></script><script src="/js/scroll.js?version=1.7.0"></script><script src="/js/head.js?version=1.7.0"></script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css"><script src="/js/katex.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>